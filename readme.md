# MODRON
MODRON是一款以质因数同余为基本原理，仿造FRACTRAN语言的工作方式，构造的试验性程序语言。
## 原理
### MODRON状态机
MODRON状态机为一种寄存器状态机，仅需要保存2个整数就能工作：M与V。
* M为一组质数的乘积，每一个质数P表示一个寄存器P。
* V保存所有寄存器的值。每一个寄存器P的值表示为V模P，即 V % P 。

因为上述设计，每一个寄存器P仅能保存从0到P-1的数值。需要更高的上限则要使用更高的寄存器，但是没有寄存器的数值可以无限增大。
### MODRON程序
MODRON程序为一个3元整数组(cshift, condi, op)的序列。
#### 执行
程序执行时，由序列最初的3元组开始。
* 首先由cshift和condi来检查条件是否通过。
* 若条件通过，则执行op。
* 若条件不通过，则取下一个3元组，重复上述过程。

#### 3元组
* 判断条件时，首先将状态机当前V与cshift求和，再检查其和是否整除condi。如果整除则通过，反之不通过。
* 执行操作时，将 (V+op) % M 作为状态机新的V值。

#### 循环执行
前述执行过程为一轮，当循环执行时，反复重复执行程序，直到超过了轮数上限而执行失败，或者出现了重复的V值形成稳定循环而执行成功。
因此可以让op值为0作为循环强制结束的标志。
### 编译
根据中国剩余定理，可以非常便捷的求出任何一质数为模的同余方程组。以此原理可以很容易的将寄存器的数值判断和增减操作，编译为上述程序。

## 描述语言
本程序中包括一个将寄存器操作描述编译为上述MODRON语言的解释器。描述语言如下设计。
### 基本元素
* num 整数
* prime 质数
* id 可含_的由非数字开头的字符串
* newline 换行符
* non 空

### 语言定义
* 寄存器描述对
`pair ::= prime ":" num`
* 条件
`condi ::= non | condi pair`
* 操作
`op ::= non | op pair`
* 语句
`stmt ::= condi "/" op`
* 程序
`prog ::= stmt | prog newline stmt`
* 块名
`sname ::= id`
* 参数序列
`args ::= non | args (id | num)`
* 内建函数
`func ::= id "(" args ")"`
* 块序列
`sseq ::= (sname | func) | sseq (sname | func)`
* 块
`sect ::= sname ":" newline (prog | sseq)`

### 内建函数
* out()，将当前modron状态机中所有寄存器的值都压入输出序列。
* out\(p\)，将当前寄存器p的值压入输出序列。

## 解释器
main.py文件为解释器入口程序，用于执行描述文件中的程序块。具体参数说明可使用`main.py -h`进行查看。
## 示例
程序中含有一个斐波拉契数列的示例程序`fib.mdr.txt`。
* 可通过命令`main.py fib.mdr.txt -e entry -v`来执行并查看具体执行过程。
* 或通过命令`main.py fib.mdr.txt`执行并仅查看结果。
* 或通过命令`main.py fib.mdr.txt -c`仅查看编译后的modron的3元组程序。
